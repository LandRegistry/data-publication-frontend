{% extends "data_publication_base.html" %}

{% block page_title %}Land Registry Data - Overseas Ownership Dataset{% endblock %}
{% block body %}
<div class="grid-row">

  <div id="global-breadcrumb" class="header-context column-three-quarters">
    <nav role="navigation" class="expand-top-half expand-bottom-half">
      <ol class="group">
        <li><a href="{{ url_prefix }}/" id="details">Dataset Details</a></li>
        <li><a href="{{ url_prefix }}/usertype" id="usertype">User type</a></li>
        <li><a href="{{ url_prefix }}/personal" id="personal">Personal details</a></li>
        <li><a href="{{ url_prefix }}/address" id="address">Address</a></li>
        <li><a href="{{ url_prefix }}/tel" id="contact">Contact Details</a></li>
        <li><a href="{{ url_prefix }}/recaptcha" id="recaptcha">reCAPTCHA Check</a></li>
        <li><a href="{{ url_prefix }}/terms" id="terms">Terms and conditions</a></li>
        <li><a href="{{ url_prefix }}/data" id="download">Dataset Download</a></li>
      </ol>
    </nav>
  </div>

</div>

<h1 class="heading-xlarge">Land Registry Data</h1>
<h2 class="heading-large">
  <span class="heading-secondary">Step 7 of 7</span>
  Download Dataset Files
</h2>
<div id="valid-link-message">Please note that these download links will only remain valid for <span id="duration">{{ duration }}</span>.</div>
<div class="grid-row">
  <div class="column-half">
    <h3 class="heading-medium">Datasets</h3>
    <ul>
      {% for link in datasets %}
      <li>
        <div style="margin-bottom:4%">
          <div style="float:left; margin-right:2%">
            <span class="icon icon-download" alt="download" title="download"></span>
          </div>
          <div>
            <a href='{{ link["url"] }}' onClick="ga('send', 'event', { eventCategory: 'Dataset', eventAction: 'Download', eventLabel: '{{ link['filename'] }}'});">{{ link["filename"] }}</a>
            <br/>
            <span class="text-secondary">({{ link["size"] }})</span>
          </div>
        </div>
      </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}
{% block js_additionals %}
  <script>
    window.load=countdown();
    function countdown() {
      var refreshIntervalId = setInterval(function() {
        var duration = document.getElementById('duration');
        temp = duration.innerHTML.split(' ');
        totalSeconds = ((temp[0] * 60) + parseInt(temp[2])) - 1;
        minutes = Math.floor(totalSeconds / 60);
        seconds = totalSeconds % 60;
        duration.innerHTML = minutes + " minute(s) " + seconds + " second(s)";
        if (totalSeconds == 0) {
          clearInterval(refreshIntervalId);
          document.getElementById('valid-link-message').innerHTML = 'The download links have expired. You may need to reload the page.';
          document.getElementById('valid-link-message').style.color = 'red';
        }
      }, 1000);
    }
  </script>
{% endblock %}
